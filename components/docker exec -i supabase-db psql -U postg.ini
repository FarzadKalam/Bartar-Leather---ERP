docker exec -i supabase-db psql -U postgres -d postgres <<EOF
-- 1. تعمیر دسترسی‌ها (حل ارور Database error querying schema)
GRANT USAGE ON SCHEMA auth TO postgres, anon, authenticated, service_role;
GRANT SELECT ON ALL TABLES IN SCHEMA auth TO postgres, anon, authenticated, service_role;
GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA auth TO postgres, anon, authenticated, service_role;

-- تنظیم مسیر جستجو برای نقش‌ها (خیلی مهم برای پیدا کردن جداول)
ALTER ROLE anon SET search_path TO public, auth;
ALTER ROLE authenticated SET search_path TO public, auth;
ALTER ROLE service_role SET search_path TO public, auth;
ALTER ROLE postgres SET search_path TO public, auth;

-- 2. ریست کردن رمز عبور به 123456
CREATE EXTENSION IF NOT EXISTS pgcrypto;

UPDATE auth.users
SET 
    encrypted_password = crypt('Kalam8070', gen_salt('bf')),
    email_confirmed_at = now(),
    updated_at = now()
WHERE email = 'fj.lyric@gmail.com';

-- تایید نهایی
DO \$\$
DECLARE
    u_count INT;
BEGIN
    SELECT count(*) INTO u_count FROM auth.users WHERE email = 'fj.lyric@gmail.com';
    IF u_count > 0 THEN
        RAISE NOTICE 'Password reset successfully for fj.lyric@gmail.com';
    ELSE
        RAISE NOTICE 'User NOT FOUND! Please ensure the email is correct.';
    END IF;
END \$\$;
EOF